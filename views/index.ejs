<!DOCTYPE html>
<html lang="ja" class="bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本固有種検索</title>
    <link href="/styles/main.css" rel="stylesheet">
</head>
<body class="antialiased text-gray-900">
    <div class="min-h-screen bg-gray-100 py-6 flex flex-col justify-center sm:py-12">
        <div class="relative py-3 sm:max-w-xl sm:mx-auto">
            <div class="relative px-4 py-10 bg-white shadow-lg sm:rounded-3xl sm:p-20">
                <h1 class="text-3xl font-bold mb-5 text-center text-indigo-600">日本固有種検索</h1>
                
                <form action="/" method="GET" class="mb-5">
                    <div class="flex items-center border-b border-indigo-500 py-2">
                        <input class="appearance-none bg-transparent border-none w-full text-gray-700 mr-3 py-1 px-2 leading-tight focus:outline-none" type="text" id="query" name="query" value="<%= locals.query || '' %>" required placeholder="検索キーワード">
                        <button class="flex-shrink-0 bg-indigo-500 hover:bg-indigo-700 border-indigo-500 hover:border-indigo-700 text-sm border-4 text-white py-1 px-2 rounded" type="submit">検索</button>
                    </div>
                </form>

                <% if (locals.error) { %>
                    <p class="text-red-500 mb-5"><strong>エラー:</strong> <%= error %></p>
                <% } %>

                <% if (locals.species && species.length > 0) { %>
                    <h2 class="text-2xl font-semibold mb-4 text-indigo-800">検索結果</h2>
                    <ul class="space-y-6">
                    <% species.forEach(species => { %>
                        <li class="bg-gray-50 rounded-lg shadow p-6">
                            <h3 class="text-xl font-bold text-indigo-700 mb-2">
                                <%= species.japanese_name %> 
                                (<% 
                                let scientificName = species.scientific_name;
                                if (!scientificName) {
                                    scientificName = [species.genus_name, species.species_name, species.subspecies_name].filter(Boolean).join(' ');
                                } else if (!species.genus_name && !species.species_name) {
                                    let parts = scientificName.split(' ');
                                    species.genus_name = parts[0] || '';
                                    species.species_name = parts.slice(1).join(' ') || '';
                                }
                                %><span class="italic"><%= scientificName %></span>)
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <p><span class="font-semibold">目:</span> <%= species.order_name_ja || '不明' %> (<%= species.order_name_en || 'Unknown' %>)</p>
                                <p><span class="font-semibold">科:</span> <%= species.family_name_ja || '不明' %> (<%= species.family_name_en || 'Unknown' %>)</p>
                                <p><span class="font-semibold">属:</span> <%= species.genus_name || '不明' %></p>
                                <p><span class="font-semibold">種:</span> <%= species.species_name || '不明' %></p>
                                <% if (species.subspecies_name) { %>
                                    <p><span class="font-semibold">亜種:</span> <%= species.subspecies_name %></p>
                                <% } %>
                            </div>
                            <p class="mt-2"><span class="font-semibold">分布:</span> <%= species.distribution || '不明' %></p>
                            <% if (species.note) { %>
                                <p class="mt-2 text-gray-600"><span class="font-semibold">備考:</span> <%= species.note %></p>
                            <% } %>
                        </li>
                    <% }); %>
                    </ul>
                <% } else if (locals.query) { %>
                    <p class="text-gray-600 italic">該当する種が見つかりませんでした。</p>
                <% } %>
            </div>
        </div>
    </div>
</body>
</html>

